<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Thoughts</title>

  <!-- Supabase Client (loaded first) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2  "></script>

  <!-- Emoji Picker (module) -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@  ^1/index.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- ðŸ‘‡ CREATE SUPABASE CLIENT ONCE, GLOBALLY, BEFORE ANY MODULES -->
  <script>
    window.supabaseClient = window.supabase.createClient(
      'https://ccetnqdqfrsitooestbh.supabase.co  ',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjZXRucWRxZnJzaXRvb2VzdGJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMTE4MjksImV4cCI6MjA3Nzg4NzgyOX0.1NjRZZrgsPOg-2z_r2kRELWn9IVXNEQNpSxK6CktJRY'
    );
  </script>
</head>
<body>
  <div class="thought-box">
    <textarea id="memory-body" placeholder="what's going on?"></textarea>
    <div class="thought-actions">
      <button id="mediaButton">âž•</button>
      <button id="emojiButton">ðŸ™‚</button>
      <button id="postButton">Post</button>
    </div>
    <div id="emojiPicker"></div>
    
    <div id="uploadProgress" style="display:none; margin-top: 10px;">
      <div class="progress-bar" style="height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden;">
        <div id="progressFill" style="height: 100%; background: #5a67d8; width: 0%; transition: width 0.3s ease;"></div>
      </div>
      <span id="progressText" style="display: block; margin-top: 5px; font-size: 14px; color: #4a5568;">Uploading...</span>
    </div>
    
    <div id="mediaPreviewContainer" style="margin-top: 12px; padding: 8px; background: #f9f9f9; border-radius: 8px; display: none;"></div>
  </div>

  <div class="posts-section">
    <h2>My Posts</h2>
    <div id="postsContainer"></div>
  </div>

  <input type="file" id="mediaInput" accept="image/*,video/*" style="display:none;" multiple />

  <!-- Edit Modal -->
  <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; padding: 20px; overflow-y: auto;">
    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: 50px auto; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
      <h3>Edit Post</h3>
      
      <!-- Close Button -->
      <button id="closeEditModal" style="position: absolute; top: 10px; right: 10px; background: #e53e3e; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Ã—</button>
      
      <!-- Text Editor -->
      <textarea id="editBody" style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin: 10px 0;"></textarea>
      
      <!-- Media Section -->
      <div style="margin: 10px 0;">
        <label>Existing Media:</label>
        <div id="editMediaContainer" style="display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0;"></div>
        
        <button id="addMoreMediaButton" style="background: #4299e1; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Add More Media</button>
        <input type="file" id="addMoreMediaInput" multiple accept="image/*,video/*" style="display: none;" />
      </div>
      
      <!-- Upload Progress -->
      <div id="editUploadProgress" style="display: none; margin: 10px 0;">
        <div style="width: 100%; background: #eee; border-radius: 4px; overflow: hidden;">
          <div id="editProgressFill" style="height: 10px; background: #4299e1; width: 0%; transition: width 0.3s;"></div>
        </div>
        <div id="editProgressText" style="margin-top: 5px; font-size: 12px;">Uploading...</div>
      </div>
      
      <!-- Action Buttons -->
      <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <button id="deleteEditButton" style="background: #e53e3e; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">Delete Post</button>
        <button id="saveEditButton" style="background: #4299e1; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Load media handling first as a module to ensure global functions are available -->
  <script type="module" src="media.js"></script>
  <!-- Then load main logic -->
  <script type="module" src="script.js"></script>
</body>
</html>
