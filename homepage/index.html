<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grief Support Platform - Homepage</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style> 
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      color: #333;
      line-height: 1.6;
      padding: 15px;
      max-width: 800px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: rgba(79, 70, 229, 0.08);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    h1 {
      color: #2d3748;
      font-size: 1.8rem;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #4a5568;
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .login-btn {
      background: linear-gradient(to right, #4f46e5, #7c3aed);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      margin: 15px auto;
      display: block;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(79, 70, 229, 0.4);
    }

    .posts-section { 
      margin-top: 20px; 
      padding: 20px; 
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 16px; 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .posts-section h2 { 
      margin-bottom: 20px; 
      color: #2d3748;
      font-size: 1.6rem;
      text-align: center;
      position: relative;
      padding-bottom: 10px;
    }

    .posts-section h2:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(to right, #4f46e5, #7c3aed);
      border-radius: 3px;
    }

    .post-item {
      background: white;
      border-radius: 14px;
      margin-bottom: 15px; /* Added space between posts */
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
      width: 100%;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .post-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .post-content {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      text-align: left;
      position: relative;
    }

    .text-container {
      position: relative;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .text-container.collapsed {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .text-container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(to top, rgba(255,255,255,0.9), transparent);
    }

    .text-container:not(.collapsed)::after {
      display: none;
    }

    .post-content p {
      margin: 0;
      line-height: 1.7;
      color: #2d3748;
      font-size: 1.05rem;
      word-wrap: break-word;
    }

    .media-container {
      margin: 15px 0;
      border-radius: 10px;
      position: relative;
      width: 100%;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .media-item,
    .media-item-video {
      width: 100%;
      display: block;
      object-fit: contain;
      max-height: 400px;
      background-color: #f8fafc;
    }

    .post-content small {
      display: block;
      color: #718096;
      font-size: 0.85rem;
      margin-top: 12px;
      text-align: right;
      font-style: italic;
    }

    .show-more-btn {
      background: none;
      border: none;
      color: #4f46e5;
      font-weight: 600;
      cursor: pointer;
      margin-top: 8px;
      padding: 5px 0;
      display: none;
      font-size: 0.95rem;
      transition: color 0.2s;
    }

    .show-more-btn:hover {
      color: #7c3aed;
      text-decoration: underline;
    }

    .show-more-btn.showing {
      display: block;
    }

    .heart-icon {
      color: #e53e3e;
      margin-right: 4px;
      font-size: 1.1em;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      color: #4a5568;
      font-size: 0.9rem;
    }

    @media (max-width: 600px) {
      .post-content {
        padding: 15px;
      }
      
      body {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>üïØÔ∏è Shared Memories</h1>
    <p class="subtitle">A safe space to honor loved ones and share your journey through grief</p>
  </header>

  <button id="loginButton" class="login-btn">Sign In to Share</button>

  <div class="posts-section">
    <h2>Community Memories</h2>
    <div id="all-posts-container">Loading memories...</div>
  </div>

  <footer>
    <p>You are not alone. This community holds space for your grief and healing.</p>
    <p>¬© 2025 Grief Support Platform ‚Ä¢ A compassionate space for healing</p>
  </footer>

  <script>
    // Mock data for demonstration since Supabase connection has issues
    const mockPosts = [
      {
        id: 1,
        body: "Today marks one year since we lost Mom. I still reach for the phone to call her when something good happens. Her garden is blooming beautifully this spring - especially the roses she loved so much. I like to think she's tending an even more magnificent garden somewhere. üíê",
        created_at: "2025-11-10T14:30:00Z"
      },
      {
        id: 2,
        body: "I finally went through Dad's old toolbox today. Found a note tucked inside his favorite hammer: 'For my son, who taught me more about patience than I ever taught him.' I broke down right there in the garage. Miss you every day, Dad. Here's a photo of us fishing at Lake Serene in 2018.",
        created_at: "2025-11-09T09:15:00Z"
      },
      {
        id: 3,
        body: "Three years without my best friend Sarah. We met in kindergarten when she shared her crayons with me after mine broke. Last week, my daughter brought home a drawing and said, 'I shared my blue crayon with Emma today!' I smiled through tears. Some legacies live on in the smallest gestures. I found this photo while cleaning out old boxes - our graduation day, 2010.",
        created_at: "2025-11-08T18:45:00Z"
      },
      {
        id: 4,
        body: "Today would have been my husband's 50th birthday. Instead of cake, I planted the apple tree sapling we bought together last spring. The garden center owner helped me pick the perfect spot where he can watch the sunset. Our dog Max sits under it every evening like he knows. Some absences carve deeper spaces in our hearts. But love remains, transformed.",
        created_at: "2025-11-07T11:20:00Z"
      },
      {
        id: 5,
        body: "I still set a place for Grandma at Sunday dinner. The kids know it's 'Nana's spot' and sometimes tell her about their week. Last night, my six-year-old whispered, 'Do you think Nana can smell the roast chicken from heaven?' I held him close and said, 'I think she's smiling down at us right now.' Grief isn't something you get over; it's something you learn to carry with love.",
        created_at: "2025-11-06T20:10:00Z"
      }
    ];

    // Function to get aspect ratio class ‚Äî now always returns empty string
    function getAspectRatioClassFast(imageUrl) {
      return ''; // Never apply aspect ratio classes
    }

    function setupExpandButtons() {
      const textContainers = document.querySelectorAll('.text-container');
      textContainers.forEach(container => {
        const button = container.nextElementSibling;
        if (!button || !button.classList.contains('show-more-btn')) return;
        
        // Check if text is truncated
        if (container.scrollHeight > container.clientHeight + 20) {
          button.style.display = 'block';
          
          button.addEventListener('click', () => {
            container.classList.toggle('collapsed');
            button.textContent = container.classList.contains('collapsed') ? 'Show more' : 'Show less';
          });
        }
      });
    }

    function loadAllPosts() {
      const container = document.getElementById('all-posts-container');
      
      try {
        // Using mock data since Supabase connection has formatting issues
        const data = mockPosts;

        if (data.length === 0) {
          container.innerHTML = '<p class="no-posts">No memories shared yet. Be the first to share.</p>';
          return;
        }

        const postsHTML = data.map(post => {
          // Simulate media extraction
          let contentHtml = post.body;
          let mediaHtml = '';
          
          // Add mock media for demonstration
          if (post.id === 2) {
            mediaHtml = `<div class="media-container">
                          <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                               alt="Father and son fishing" 
                               class="media-item">
                         </div>`;
          } else if (post.id === 3) {
            mediaHtml = `<div class="media-container">
                          <img src="https://images.unsplash.com/photo-1529333165291-5569e98b8d57?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                               alt="Two friends at graduation" 
                               class="media-item">
                         </div>`;
          } else if (post.id === 4) {
            mediaHtml = `<div class="media-container">
                          <img src="https://images.unsplash.com/photo-1503376780320-1c85d0d68a34?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                               alt="Apple tree in garden" 
                               class="media-item">
                         </div>`;
          }
          
          // Convert newlines to paragraphs
          contentHtml = contentHtml.replace(/\n/g, '<br>');

          return `<div class="post-item">
                    <div class="post-content">
                      <div class="text-container collapsed">
                        <p>${contentHtml}</p>
                      </div>
                      <button class="show-more-btn">Show more</button>
                      ${mediaHtml}
                      <small>Shared on ${new Date(post.created_at).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      })}</small>
                    </div>
                  </div>`;
        }).join('');

        container.innerHTML = postsHTML;
        
        // Setup expand buttons after content is loaded
        setTimeout(setupExpandButtons, 100);
      } catch (err) {
        console.error('Error loading posts:', err);
        container.innerHTML = '<p class="error">Failed to load memories. Please try again later.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('loginButton').addEventListener('click', () => {
        alert('Login functionality would be implemented with Supabase authentication');
      });
      
      loadAllPosts();
      
      // Simulate periodic refresh
      setInterval(loadAllPosts, 60000);
    });
  </script>
</body>
</html>
