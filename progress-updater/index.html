<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Updater</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .progress-updater-header {
            margin-bottom: 20px;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            background-color: white;
            border-radius: 8px;
        }

        .progress-updater-header h2 {
            margin: 0 0 15px 0;
            color: #333;
        }

        #add-step-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        #add-step-btn:hover {
            background-color: #0056b3;
        }

        .progress-step {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #fafafa;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-header h3 {
            margin: 0;
            color: #555;
        }

        .remove-step-btn {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 16px;
        }

        .step-text {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 15px;
            resize: vertical;
        }

        .media-upload-section {
            margin-bottom: 15px;
        }

        .media-upload-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .media-upload-input {
            margin-bottom: 10px;
        }

        .media-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .media-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .remove-media-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-updater-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
        }

        #save-progress-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #save-progress-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div id="content">
        <div class="progress-updater-header">
            <h2>Share Your Journey</h2>
            <button id="add-step-btn" class="btn btn-primary">Add Step</button>
        </div>
        
        <div id="steps-container">
            <!-- Steps will be added here dynamically -->
        </div>
        
        <div class="progress-updater-actions">
            <button id="save-progress-btn" class="btn btn-success">Save Journey</button>
        </div>
    </div>

    <script>
        class ProgressUpdater {
            constructor() {
                this.steps = [];
                this.currentStepIndex = 0;
                this.init();
            }

            init() {
                this.bindEvents();
            }

            bindEvents() {
                document.getElementById('add-step-btn').addEventListener('click', () => {
                    this.addStep();
                });
                
                document.getElementById('save-progress-btn').addEventListener('click', () => {
                    this.saveProgress();
                });
            }

            addStep() {
                const stepIndex = this.steps.length;
                const stepId = `step-${stepIndex}`;
                
                const stepElement = document.createElement('div');
                stepElement.className = 'progress-step';
                stepElement.id = stepId;
                stepElement.innerHTML = `
                    <div class="step-header">
                        <h3>Step ${stepIndex + 1}</h3>
                        <button class="remove-step-btn" data-step="${stepIndex}">×</button>
                    </div>
                    <div class="step-content">
                        <textarea class="step-text" placeholder="Describe this step of your journey..." rows="4"></textarea>
                        
                        <div class="media-upload-section">
                            <label>Upload Media:</label>
                            <input type="file" class="media-upload-input" accept="image/*,video/*" multiple data-step="${stepIndex}">
                            <div class="media-preview-container" id="preview-${stepIndex}"></div>
                        </div>
                        
                        <div class="media-display-container" id="display-${stepIndex}"></div>
                    </div>
                `;
                
                document.getElementById('steps-container').appendChild(stepElement);
                
                // Bind media upload events for this specific step
                this.bindStepMediaEvents(stepIndex);
                
                // Add step to our internal array
                this.steps.push({
                    text: '',
                    media: []
                });

                // Bind remove step event
                stepElement.querySelector('.remove-step-btn').addEventListener('click', () => {
                    this.removeStep(stepIndex);
                });
            }

            removeStep(stepIndex) {
                this.steps.splice(stepIndex, 1);
                document.getElementById(`step-${stepIndex}`).remove();
                
                // Re-index remaining steps
                this.reindexSteps();
            }

            reindexSteps() {
                const stepElements = document.querySelectorAll('.progress-step');
                stepElements.forEach((element, index) => {
                    element.id = `step-${index}`;
                    element.querySelector('h3').textContent = `Step ${index + 1}`;
                    element.querySelector('.remove-step-btn').dataset.step = index;
                    
                    const textInput = element.querySelector('.step-text');
                    const mediaInput = element.querySelector('.media-upload-input');
                    const previewContainer = element.querySelector(`#preview-${index + 1}`) || element.querySelector('.media-preview-container');
                    const displayContainer = element.querySelector(`#display-${index + 1}`) || element.querySelector('.media-display-container');
                    
                    mediaInput.dataset.step = index;
                    previewContainer.id = `preview-${index}`;
                    displayContainer.id = `display-${index}`;
                });
            }

            bindStepMediaEvents(stepIndex) {
                const uploadInput = document.querySelector(`.media-upload-input[data-step="${stepIndex}"]`);
                const previewContainer = document.getElementById(`preview-${stepIndex}`);
                
                uploadInput.addEventListener('change', (e) => {
                    this.handleMediaUpload(e, stepIndex, previewContainer);
                });
            }

            handleMediaUpload(event, stepIndex, previewContainer) {
                const files = Array.from(event.target.files);
                const step = this.steps[stepIndex];
                
                files.forEach(file => {
                    const mediaId = `media-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    
                    const mediaData = {
                        id: mediaId,
                        file: file,
                        type: file.type.startsWith('image') ? 'image' : 'video',
                        name: file.name
                    };
                    
                    step.media.push(mediaData);
                    
                    // Create preview
                    const previewElement = this.createMediaPreview(mediaData, stepIndex);
                    previewContainer.appendChild(previewElement);
                });
            }

            createMediaPreview(mediaData, stepIndex) {
                const preview = document.createElement('div');
                preview.className = 'media-preview-item';
                preview.dataset.mediaId = mediaData.id;
                
                if (mediaData.type === 'image') {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(mediaData.file);
                    img.alt = mediaData.name;
                    preview.appendChild(img);
                } else {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(mediaData.file);
                    video.controls = false;
                    video.muted = true;
                    video.preload = 'metadata';
                    preview.appendChild(video);
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-media-btn';
                removeBtn.textContent = '×';
                removeBtn.addEventListener('click', () => {
                    this.removeMedia(mediaData.id, stepIndex, preview);
                });
                preview.appendChild(removeBtn);
                
                return preview;
            }

            removeMedia(mediaId, stepIndex, previewElement) {
                const step = this.steps[stepIndex];
                const mediaIndex = step.media.findIndex(m => m.id === mediaId);
                
                if (mediaIndex > -1) {
                    step.media.splice(mediaIndex, 1);
                    previewElement.remove();
                }
            }

            saveProgress() {
                // Collect all step data
                this.steps.forEach((step, index) => {
                    const textElement = document.querySelector(`#step-${index} .step-text`);
                    step.text = textElement ? textElement.value : '';
                });
                
                console.log('Saving progress:', this.steps);
                // Here you would save to your backend
                // For now, just log to console
                alert('Progress saved to console (check developer tools)');
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new ProgressUpdater();
        });
    </script>
</body>
</html>
